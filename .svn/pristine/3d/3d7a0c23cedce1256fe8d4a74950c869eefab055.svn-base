var VipDevice = {
    //加载公司列表
    LoadCompanys: function () {
        $.ajax({
            type: "post",
            url: "/Company/GetComany",
            dataType: "json",
            error: function (ex) {
                Common.MsgBox("查询公司失败,请稍后再试" + ex.responseText);
            },
            success: function (data) {
                var str = "";
                for (var i = 0; i < data.length; i++) {
                    str += "<option value=" + data[i].CompanyID + ">" + data[i].CompanyName + "</option>";
                }
                $("#Company").append(str);
            }
        });
    },
    //查询了站点列表
    GetDTUList: function () {
        var companyId = $("#Company").val();
        $.ajax({
            type: "post",
            url: "/VipDevice/GetDTUListByComanyId",
            data: { companyId: companyId },
            dataType: "json",
            error: function (ex) {
                Common.MsgBox("查询站点失败,请稍后再试" + ex.responseText);
            },
            success: function (data) {
                var str = "";
                for (var i = 0; i < data.length; i++) {
                    str += "<option value='" + data[i].Key + "'>" + data[i].Value + "</option>"
                }
                $("#SiteName").html(str);
            }
        });
    },
    //查询设备信息
    GetVipDevice: function () {
        var dtuId = $("#SiteName").val();
        $.ajax({
            type: "post",
            url: "/VipDevice/GetVipDeviceList",
            data: { dtuId: dtuId },
            dataType: "json",
            error: function (ex) {
                Common.MsgBox("查询重要设备失败,请稍后再试" + ex.responseText);
            },
            success: function (data) {
                var html = "";
                for (var a in data) {
                    html += "<tr>";
                    html += "<td class='com_w20pen com_TextCenter'>" + data[a].DeviceName + "</td>";
                    html += "<td class='com_w20pen com_TextCenter'>" + data[a].DeviceBrand + "</td>";
                    html += "<td class='com_w20pen com_TextCenter'>" + data[a].ModelCode + "</td>";
                    html += "<td class='com_w20pen com_TextCenter'>" + VipDevice.ChangeDateFormat(data[a].ProduceDate) + "</td>";
                    html += "<td class='com_w20pen com_TextCenter'>";
                    html += "<a href='javascript:void(0)' onclick=Common.WinTopBox('设备查看','40%','62%','12%','30%','VipDevice/VipDeviceDetail?oper=Show&Id=" + data[a].Id + "')>查看|</a> ";
                    html += "<a href='javascript:void(0)' onclick=Common.WinTopBox('设备修改','40%','62%','12%','30%','VipDevice/VipDeviceDetail?oper=Edit&Id=" + data[a].Id + "')>修改|</a> ";
                    html += "<a href='javascript:void(0)' onclick=VipDevice.DeleteDevice('" + data[a].Id + "')>删除</a> ";
                    html += "</td>";
                    html += "</tr>";
                }
                $("#DeviceList tbody").html(html);
            }
        });
    },
    //日期格式转换
    ChangeDateFormat: function (date) {
        date = date.replace("/Date(", "").replace(")/", "");
        if (date.indexOf("+") > 0) {
            date = date.substring(0, date.indexOf("+"));
        }
        else if (date.indexOf("-") > 0) {
            date = date.substring(0, date.indexOf("-"));
        }

        var date = new Date(parseInt(date, 10));
        var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
        var currentDate = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
        return date.getFullYear() + "-" + month + "-" + currentDate;
    },
    //日历控件
    SetDateCtrl: function () {
        return WdatePicker({ dateFmt: 'yyyy-MM-dd' });
    },
    //添加设备
    AddDevice: function () {
        var model = {
            "DeviceName": $("#txtDeviceName").val().trim(),
            "Dtuid": $("#SiteName").val(),
            "DeviceBrand": $("#txtBrand").val().trim(),
            "DeviceSN": $("#txtDeviceSN").val().trim(),
            "ModelCode": $("#txtModelCode").val().trim(),
            "DeviceParams": $("#txtParams").val().trim(),
            "ProduceDate": $("#txtDate").val(),
            "Memo": $("#txtDesc").val().trim()
        };
        $.ajax({
            type: "post",
            url: "/VipDevice/AddDevice",
            data: model,
            dataType: "text",
            error: function (ex) {
                Common.MsgBox("添加设备失败,请稍后再试" + ex.responseText);
            },
            success: function (data) {
                if (data == "true") {
                    Common.layoutTopClose();
                    $("#framecenter iframe", parent.document).contents().find("#btnQuery").trigger("click");
                }
                else {
                    alert("添加失败");
                }
            }
        });
    },
    //修改设备
    UpdateDevice: function () {
        var model = {
            "Id": $("#txtDeviceName").attr("name"),
            "DeviceName": $("#txtDeviceName").val().trim(),
            "Dtuid": $("#SiteName").val(),
            "DeviceBrand": $("#txtBrand").val().trim(),
            "DeviceSN": $("#txtDeviceSN").val().trim(),
            "ModelCode": $("#txtModelCode").val().trim(),
            "DeviceParams": $("#txtParams").val().trim(),
            "ProduceDate": $("#txtDate").val(),
            "Memo": $("#txtDesc").val().trim()
        };
        $.ajax({
            type: "POST",
            url: "/VipDevice/UpdateDevice",
            data: model,
            dataType: "text",
            error: function (ex) {
                Common.MsgBox("修改设备失败,请稍后再试" + ex.responseText);
            },
            success: function (data) {
                if (data == "true") {
                    Common.layoutTopClose();
                    $("#framecenter iframe", parent.document).contents().find("#btnQuery").trigger("click");
                }
                else {
                    alert("修改失败");
                }
            }
        });
    },
    //删除设备
    DeleteDevice: function (id) {
        if (confirm("确定要删除吗？")) {
            $.ajax({
                type: "post",
                url: "/VipDevice/DeleteDevice",
                data: { id: id },
                dataType: "text",
                error: function (ex) {
                    Common.MsgBox("删除设备失败,请稍后再试" + ex.responseText);
                },
                success: function (data) {
                    if (data == "true") {
                        alert("删除成功");
                        $("#framecenter iframe", parent.document).contents().find("#btnQuery").trigger("click");
                    }
                    else {
                        alert("删除失败");
                    }
                }
            });
        }
    }
}