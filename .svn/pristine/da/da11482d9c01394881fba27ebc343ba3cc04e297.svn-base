<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>字段管理（加强）</title>
    <link href="~/Scripts/JqEasyUI/themes/default/easyui.css" rel="stylesheet" />
    <link href="~/Style/Site.css" rel="stylesheet" />
    <link href="~/Style/common.css" rel="stylesheet" />
    <link href="~/Scripts/JqEasyUI/themes/icon.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-1.7.1.min.js"></script>
    <script src="~/Scripts/Common/GlobalLoading.js"></script>
    <script src="~/Scripts/JqEasyUI/jquery.easyui.min.js"></script>
    <script src="~/Scripts/JqEasyUI/easyloader.js"></script>
    <script src="~/Scripts/Common/Common.js"></script>
    <script src="~/Scripts/ClientMng/ClientInfoMng.js"></script>
    <script src="~/Scripts/SiteMng/SiteMng.js"></script>
    <script src="~/Scripts/FieldMng/FiledMng.js"></script>
    <script src="~/Scripts/Common/ui-com-table.js" type="text/javascript"></script>
    <script src="~/Scripts/UserMng/UserDtu.js"></script>
    <link href="~/Style/uploadify.css" rel="stylesheet" />
    <script src="~/Scripts/jquery.uploadify.min.js"></script>
    <script type="text/javascript">
        $(function () {
            //初始化
            $("#tbDiv").css("height", $(window).height() * 0.87);
            new comTab().fnInit();

            $("#uploadify").uploadify({
                'debug': false, //开启或关闭调试
                'auto': true, //是否自动上传
                'buttonText': '请选择文件', //设置按钮文字
                'swf': "../Style/imgs/uploadify.swf", //flsh
                //'queueID': 'file_uploadQueue', //文件选择后的容器ID
                'uploader': '/FieldPower/UpLoadFile', //后台处理程序
                'width': '100', //设置按钮宽度(单位px)
                'height': '23', //设置按钮高度(单位px)
                'multi': false, //设置是否允许一次选择多个文件
                'fileTypeDesc': '支持的格式：', //可选文件的描述
                'fileTypeExts': '*.xls;', //设置允许上传的文件扩展名
                'fileSizeLimit': '100MB', //设置上传文件的容量最大值
                'removeTimeout': 1, //设置上传完成后删除掉文件的延迟时间，默认为3秒
                'queueSizeLimit': 1, //设置每一次上传队列中的文件数量
                'onFallback': function () { //在初始化时检测不到浏览器有兼容性的flash版本时实触发
                    alert("您未安装FLASH控件，无法上传图片，请安装FLASH控件后再试！");
                },
                'onSelectError': function (file, errorCode, errorMsg) { //选择文件出错时触发
                    switch (errorCode) {
                        case -100:
                            alert("上传的文件数量已经超出系统限制的" + $('#file_upload').uploadify('settings', 'queueSizeLimit') + "个文件！");
                            break;
                        case -110:
                            alert("文件 [" + file.name + "] 大小超出系统限制的" + $('#file_upload').uploadify('settings', 'fileSizeLimit') + "大小！");
                            break;
                        case -120:
                            alert("文件 [" + file.name + "] 大小异常！");
                            break;
                        case -130:
                            alert("文件 [" + file.name + "] 类型不正确！");
                            break;
                        default:
                            break;
                    }
                },
                'onSelect': function (file) { //选择每个文件增加进队列时触发
                    //$("#container").html("");
                    //funShowProcessBar();
                },
                'onUploadError': function (file, errorCode, errorMsg) { //一个文件完成上传但返回错误时触发
                    alert("文件上传失败！", "文件格式有误，请重新下载正确的模板！");
                },
                'onUploadSuccess': function (file, data, response) { //每个文件上传成功后触发          
                    //if (data.indexOf("table") != -1) {
                    //    setTimeout(function () { $("#container").append(data); }, 2000);
                    //}
                    //else {
                    //    setTimeout(function () { $.jBox.error(data, '系统提示'); }, 2000);
                    //}
                    //funShowProcessBar();
                }
            });

            //获取公司、分组
            Common.GetCompany($("#ddlCompany"), function () { Common.GetGroup($("#ddlGroup"), $("#ddlCompany").val(), null); });

            //查询
            $("#btnQuery").click(function () {
                Search();
                new comTab().fnResizeTable();
            });

            //上传
            $("#btnUpload").click(function () {
                Upload();
            });
        });


        //查询
        function Search() {
            $.ajax({
                type: "post",
                data: { Company: $("#ddlCompany").val(), Group: $("#ddlGroup").val(), SiteName: "" },
                url: "/FieldInfo/GetFiledList",
                dataType: "json",
                error: function () {
                    alert("查询字段信息失败,请稍后再试");
                },
                success: function (data) {
                    var str = "";
                    for (var i = 0; i < data.length; i++) {
                        str += "<tr>";
                        str += "<td class='com_TextCenter'>" + data[i].Dtuid + "</td>";
                        str += "<td class='com_TextCenter'>" + data[i].ColName + "</td>";
                        str += "<td class='com_TextCenter'>" + data[i].FieldName + "</td>";
                        str += "<td class='com_TextCenter'>" + data[i].FieldUnit + "</td>";
                        str += "<td class='com_TextCenter'>" + data[i].ValueMin + "</td>";
                        str += "<td class='com_TextCenter'>" + data[i].ValueMax + "</td>";
                        str += "<td class='com_TextCenter'>" + data[i].Lowlimit + "</td>";
                        str += "<td class='com_TextCenter'>" + data[i].Highlimit + "</td>";
                        str += "<td class='com_TextCenter'>" + (data[i].IsAlert == 1 ? "是" : "否") + "</td>";
                        str += "<td class='com_TextCenter'>" + (data[i].IsCollect == 1 ? "是" : "否") + "</td>";
                        str += "</tr>";
                    }
                    $("#FieldList tbody").html(str);
                }
            });
        }

        //上传
        function Upload() {
            $.ajax({
                type: "post",
                url: "/FieldPower/UpLoadFile",
                dataType: "text",
                error: function () {
                    alert("上传失败,请稍后再试");
                },
                success: function (data) {
                    var a = "";
                }
            });
        }
    </script>
</head>
<body onload="$('#loading').hide()">
    <div class="com_TextCenter com_font13Px com_DivBorderGray">
        所属公司&nbsp;<select class="com_w15pen" id="ddlCompany" onchange="Common.GetGroup($('#ddlGroup'), $('#ddlCompany').val(), null);"></select>
        所属分组&nbsp;<select class="com_w15pen" id="ddlGroup"></select>
        <input type="button" value="查询" class="buttonVer2" id="btnQuery" /><br />
        @*<input type="file" name="file" />*@
        <span id="uploadify"></span>
        <input type="button" class="buttonVer2" value="上传" id="btnUpload">
        <a href="~/File/字段导入模板.xls">模板下载</a>
    </div>
    <div id="tbDiv" class="com_fl com_font13Px" style="overflow-y: auto; overflow-x: hidden">
        <table id="FieldList" class="ui-com-tab" rules="all">
            <thead>
                <tr align="left" class="panel-header">
                    <th class=' com_TextCenter'>编号
                    </th>
                    <th class="com_TextCenter">采集名称
                    </th>
                    <th class='com_TextCenter'>名称
                    </th>
                    <th class='com_TextCenter'>单位
                    </th>
                    <th class='com_TextCenter'>最小值
                    </th>
                    <th class='com_TextCenter'>最大值
                    </th>
                    <th class='com_TextCenter'>高报警值
                    </th>
                    <th class='com_TextCenter'>低报警值
                    </th>
                    <th class='com_TextCenter'>报警检查
                    </th>
                    <th class='com_TextCenter'>开启采集
                    </th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div id="loading" style="position: absolute; height: 100%; width: 100%; filter: alpha(opacity = 40); -moz-opacity: 0.4; opacity: 0.4; background: gray url(/Images/loading.gif) center center no-repeat; z-index: 100000; top: 0px; left: 0px"></div>
</body>
</html>
