var SiteAnalysis = {
    //获取电量
    GetLastPower: function (siteId) {
        $.ajax({
            type: "post",
            url: "/SiteProblem/GetPower",
            data: { siteId: siteId },
            dataType: "text",
            error: function () {
                alert("查询电量信息失败,请稍后再试");
            },
            success: function (data) {
                if (data != "" && data >= "10") {
                    $("#div_power").html("电量：" + data + "%");
                }
                else {
                    $("#div_power").html("电量低于10%").css({
                        background: "red",
                        opacity: 0.6
                    });
                }
            }
        });
    },
    //获取最后一次心跳记录
    GetLastHeartRecord: function (siteId) {
        $.ajax({
            type: "post",
            url: "/SiteProblem/GetLastHeartRecord",
            data: { siteId: siteId },
            dataType: "text",
            error: function () {
                alert("查询心跳记录失败,请稍后再试");
            },
            success: function (data) {
                var timespan = "";
                var arr = data.split(",");
                timespan = Date.parse(arr[0]) - Date.parse(arr[1]);
                if (data != "" && timespan <= 180000) {
                    $("#div_Heart").html("心跳记录：" + data);
                }
                else {
                    $("#div_Heart").html("心跳超过3分钟").css({
                        background: "red",
                        opacity: 0.6
                    });
                }
            }
        });
    },
    //获取最新2条报警记录
    GetTop2AlertRecord: function (siteId) {
        $.ajax({
            type: "post",
            url: "/SiteProblem/GetTop2AleartRecord",
            data: { siteId: siteId },
            dataType: "json",
            error: function () {
                alert("查询报警记录失败,请稍后再试");
            },
            success: function (data) {
                var str = "<table id='AlertList' class='ui-com-tab' rules='all' >";
                str += "<thead>";
                str += "<tr align='left' class='panel-header'>";
                str += "<th class='com_TextCenter com_w10pen'>总警告次数</th>";
                str += "<th class='com_TextCenter com_w20pen'>站点名称</th>";
                str += "<th class='com_TextCenter com_w20pen'>告警简述</th>";
                str += "<th class='com_TextCenter com_w10pen'>告警状态</th>";
                str += "<th class='com_TextCenter com_w15pen'>最新告警时间</th>";
                str += "<th class='com_TextCenter com_w15pen'>告警时间</th>";
                str += "<th class='com_TextCenter com_w10pen'>当前警告次数</th>";
                str += "</tr>";
                str += "</thead>";
                str += "<tbody>";
                for (var i = 0; i < data.length; i++) {
                    str += "<tr>";
                    str += "<td class='com_TextCenter com_w10pen'>" + data[i].AlertCount + "</td>";
                    str += "<td class='com_TextCenter com_w20pen'>" + $("#ddlSite option:selected").text() + "</td>";
                    str += "<td class='com_TextCenter com_w20pen com_disnote'>" + data[i].AlertDesc + "</td>";
                    str += "<td class='com_TextCenter com_w10pen'>" + (data[i].AlertState == 1 ? "已恢复" : "未查看") + "</td>";
                    str += "<td class='com_TextCenter com_w15pen'>" + Common.ChangeDate(data[i].RecentTime) + "</td>";
                    str += "<td class='com_TextCenter com_w15pen'>" + Common.ChangeDate(data[i].AlertTime) + "</td>";
                    str += "<td class='com_TextCenter com_w10pen'>" + data[i].CurAlertCount + "</td>";
                    str += "</tr>";
                }
                str += "</tbody>";
                str += "</table>";
                if (data.length > 0) {
                    $("#AlertList").remove();
                    $("#tbDiv").prepend(str);
                }
            }
        });
    },
    //获取5条最新原始数据
    GetTop5Data: function (siteId) {
        $.ajax({
            type: "post",
            url: "/SiteProblem/GetTop5OriginalData",
            data: { siteId: siteId },
            dataType: "json",
            error: function () {
                alert("查询原始数据失败,请稍后再试");
            },
            success: function (data) {
                var str = "";
                for (var i = 0; i < data.length; i++) {
                    str += "<tr>";
                    str += "<td class='com_TextCenter com_w87pen'>" + data[i].CollectData + "</td>";
                    str += "<td class='com_TextCenter com_w13pen'>" + Common.ChangeDate(data[i].COLLECTTIME) + "</td>";
                    str += "</tr>";
                }
                $("#RecordList tbody").html(str);
            }
        });
    },
    //公司改变
    CompanyChange: function () {
        Common.GetGroup($("#ddlGroup"), $("#ddlCompany").val(), function () { Common.GetSite($("#ddlSite"), $("#ddlCompany").val(), $("#ddlGroup").val(), null); });
    },
    //分组改变
    GroupChange: function () {
        Common.GetSite($("#ddlSite"), $("#ddlCompany").val(), $("#ddlGroup").val(), null);
    },
    //分析结果
    GetResult: function () {
        var str = "<div id='result' style='border:1px solid rgb(145, 215, 255);'>分析结果：<br/>";
        var power = $("#div_power").html().trim();
        var heart = $("#div_Heart").html().trim();
        if (power == "电量低于10%") {
            str += "电量低于10%<br/>";
        }
        else {
            str += "电量正常<br/>";
        }
        if (heart == "心跳超过3分钟") {
            str += "心跳超过3分钟<br>";
        }
        else {
            str += "心跳正常<br/>";
        }
        if ($("#AlertList")) {
            str += "有报警信息";
        }
        else {
            str += "无报警信息";
        }
        str += "</div>";
        $("#result").remove();
        $("#tbDiv").append(str);
    }
}